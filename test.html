<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>CSV æ¸¬è©¦é é¢</title>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-result {
            background: #f0f0f0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª CSV æ•¸æ“šæ¸¬è©¦é é¢</h1>
    <p>é€™å€‹é é¢ç”¨ä¾†æ¸¬è©¦ CSV æ–‡ä»¶æ˜¯å¦èƒ½æ­£ç¢ºè®€å–ä¸­æ–‡æ¬„ä½</p>

    <div id="results"></div>

    <script>
        async function testCSV() {
            const results = document.getElementById('results');
            
            // Test 1: Load JapanandBattleship.csv
            try {
                results.innerHTML += '<h2>æ¸¬è©¦ 1: è®€å– JapanandBattleship.csv</h2>';
                
                const response = await fetch('data/JapanandBattleship.csv');
                const text = await response.text();
                
                // Show raw first line
                const firstLine = text.split('\n')[0];
                results.innerHTML += `<div class="test-result">
                    <strong>åŸå§‹ç¬¬ä¸€è¡Œï¼ˆæ¬„ä½åç¨±ï¼‰:</strong>
                    <pre>${firstLine}</pre>
                </div>`;
                
                // Remove BOM
                const cleanText = text.replace(/^\uFEFF/, '');
                
                // Parse CSV
                const parsed = Papa.parse(cleanText, {
                    header: true,
                    skipEmptyLines: true
                });
                
                const data = parsed.data;
                
                results.innerHTML += `<div class="test-result success">
                    âœ… æˆåŠŸè®€å– ${data.length} ç­†è¨˜éŒ„
                </div>`;
                
                // Show column names
                if (data.length > 0) {
                    const columns = Object.keys(data[0]);
                    results.innerHTML += `<div class="test-result">
                        <strong>æ¬„ä½åç¨± (${columns.length} å€‹):</strong>
                        <pre>${JSON.stringify(columns, null, 2)}</pre>
                    </div>`;
                    
                    // Show first 5 rows
                    results.innerHTML += `<h3>å‰ 5 ç­†æ•¸æ“š:</h3>`;
                    const table = document.createElement('table');
                    
                    // Header
                    const thead = table.createTHead();
                    const headerRow = thead.insertRow();
                    columns.slice(0, 10).forEach(col => {
                        const th = document.createElement('th');
                        th.textContent = col;
                        headerRow.appendChild(th);
                    });
                    
                    // Body
                    const tbody = table.createTBody();
                    data.slice(0, 5).forEach(row => {
                        const tr = tbody.insertRow();
                        columns.slice(0, 10).forEach(col => {
                            const td = tr.insertCell();
                            td.textContent = row[col] || '-';
                        });
                    });
                    
                    results.appendChild(table);
                    
                    // Test Chinese column access
                    results.innerHTML += `<h3>æ¸¬è©¦ä¸­æ–‡æ¬„ä½è¨ªå•:</h3>`;
                    const testRow = data.find(r => r['èˆ‡é‚£åœ‹']);
                    if (testRow) {
                        results.innerHTML += `<div class="test-result success">
                            âœ… æˆåŠŸè¨ªå•ã€Œèˆ‡é‚£åœ‹ã€æ¬„ä½: ${testRow['èˆ‡é‚£åœ‹']}
                            <br>æ—¥æœŸ: ${testRow.date}
                            <br>PLA æ¶æ¬¡: ${testRow.pla_aircraft_sorties}
                        </div>`;
                    } else {
                        results.innerHTML += `<div class="test-result error">
                            âš ï¸ æ‰¾ä¸åˆ°æœ‰ã€Œèˆ‡é‚£åœ‹ã€æ•¸æ“šçš„è¨˜éŒ„
                        </div>`;
                    }
                }
                
            } catch (error) {
                results.innerHTML += `<div class="test-result error">
                    âŒ éŒ¯èª¤: ${error.message}
                    <pre>${error.stack}</pre>
                </div>`;
            }
            
            // Test 2: Load comprehensive data
            try {
                results.innerHTML += '<h2>æ¸¬è©¦ 2: è®€å– merged_comprehensive_data_clean.csv</h2>';
                
                const response = await fetch('data/merged_comprehensive_data_clean.csv');
                const text = await response.text();
                const cleanText = text.replace(/^\uFEFF/, '');
                
                const parsed = Papa.parse(cleanText, {
                    header: true,
                    skipEmptyLines: true
                });
                
                const data = parsed.data;
                
                results.innerHTML += `<div class="test-result success">
                    âœ… æˆåŠŸè®€å– ${data.length} ç­†è¨˜éŒ„
                </div>`;
                
                // Count rows with actual data
                const withSorties = data.filter(r => r.pla_aircraft_sorties && r.pla_aircraft_sorties !== '').length;
                const withCarrier = data.filter(r => r.china_carrier_present && r.china_carrier_present !== '' && r.china_carrier_present !== '0').length;
                const withUSTaiwan = data.filter(r => r.US_Taiwan_interaction && r.US_Taiwan_interaction !== '' && r.US_Taiwan_interaction !== '0').length;
                const withPolitical = data.filter(r => r.Political_statement && r.Political_statement !== '' && r.Political_statement !== '0').length;
                const withForeignShip = data.filter(r => r.Foreign_battleship && r.Foreign_battleship !== '' && r.Foreign_battleship !== '0').length;
                
                results.innerHTML += `<div class="test-result">
                    <strong>æ•¸æ“šçµ±è¨ˆ:</strong><br>
                    - æœ‰ PLA æ¶æ¬¡æ•¸æ“š: ${withSorties} ç­†<br>
                    - æœ‰èˆªæ¯æ´»å‹•: ${withCarrier} ç­†<br>
                    - æœ‰ç¾å°äº’å‹•: ${withUSTaiwan} ç­†<br>
                    - æœ‰æ”¿æ²»è²æ˜: ${withPolitical} ç­†<br>
                    - æœ‰å¤–åœ‹è»è‰¦: ${withForeignShip} ç­†
                </div>`;
                
                if (data.length > 0) {
                    const columns = Object.keys(data[0]);
                    results.innerHTML += `<div class="test-result">
                        <strong>æ¬„ä½åç¨±:</strong>
                        <pre>${JSON.stringify(columns, null, 2)}</pre>
                    </div>`;
                    
                    // Show some rows with data
                    const rowsWithData = data.filter(r => 
                        r.pla_aircraft_sorties || r.china_carrier_present || 
                        r.US_Taiwan_interaction || r.Political_statement || 
                        r.Foreign_battleship
                    ).slice(-10);
                    
                    if (rowsWithData.length > 0) {
                        results.innerHTML += `<h3>æœ€è¿‘ 10 ç­†æœ‰æ•¸æ“šçš„è¨˜éŒ„:</h3>`;
                        const table = document.createElement('table');
                        
                        // Header
                        const thead = table.createTHead();
                        const headerRow = thead.insertRow();
                        ['Date', 'Sorties', 'Carrier', 'US-Taiwan', 'Political', 'Foreign Ship'].forEach(col => {
                            const th = document.createElement('th');
                            th.textContent = col;
                            headerRow.appendChild(th);
                        });
                        
                        // Body
                        const tbody = table.createTBody();
                        rowsWithData.forEach(row => {
                            const tr = tbody.insertRow();
                            tr.insertCell().textContent = row.date || '-';
                            tr.insertCell().textContent = row.pla_aircraft_sorties || '-';
                            tr.insertCell().textContent = row.china_carrier_present ? 'âœ…' : '-';
                            tr.insertCell().textContent = row.US_Taiwan_interaction ? 'âœ…' : '-';
                            tr.insertCell().textContent = row.Political_statement ? 'âœ…' : '-';
                            tr.insertCell().textContent = row.Foreign_battleship ? 'âœ…' : '-';
                        });
                        
                        results.appendChild(table);
                    }
                }
                
            } catch (error) {
                results.innerHTML += `<div class="test-result error">
                    âŒ éŒ¯èª¤: ${error.message}
                </div>`;
            }
        }
        
        // Run tests when page loads
        window.addEventListener('load', testCSV);
    </script>
</body>
</html>
