<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <title>Japan MOD - PLA Sorties Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Japan Ministry of Defense naval transit monitoring">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <!-- PapaParse for CSV parsing -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }

        .navbar-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .navbar-custom .navbar-brand,
        .navbar-custom .nav-link {
            color: white !important;
        }

        .navbar-custom .nav-link:hover {
            color: #ddd !important;
        }

        .page-header {
            background: linear-gradient(135deg, #c94b4b 0%, #4b134f 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }

        .card-custom {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        #map {
            height: 450px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #c94b4b;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .strait-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin: 0.25rem;
            font-size: 0.85rem;
        }

        .strait-yonaguni { background: #e74c3c; color: white; }
        .strait-miyako { background: #3498db; color: white; }
        .strait-osumi { background: #2ecc71; color: white; }
        .strait-tsushima { background: #9b59b6; color: white; }

        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        table thead {
            background: linear-gradient(135deg, #c94b4b 0%, #4b134f 100%);
            color: white;
        }

        .transit-in { color: #27ae60; font-weight: bold; }
        .transit-out { color: #e74c3c; font-weight: bold; }

        .legend {
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .update-info {
            background: #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            font-size: 0.85rem;
            margin-bottom: 1.5rem;
        }

        .source-link {
            color: #c94b4b;
        }

        .source-link:hover {
            color: #4b134f;
        }

        .latest-event-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #c94b4b;
        }

        .latest-event-card .event-date {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .latest-event-card .event-strait {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-right: 0.3rem;
        }

        .latest-event-card .event-remark {
            font-size: 0.9rem;
            line-height: 1.5;
            margin-top: 0.5rem;
        }

        .event-popup {
            min-width: 280px;
            max-width: 350px;
        }

        .event-popup h6 {
            margin-bottom: 0.5rem;
            color: #c94b4b;
        }

        .event-popup .badge {
            font-size: 0.7rem;
            margin-right: 0.25rem;
        }

        .pulse-marker {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container">
        <a class="navbar-brand" href="index.html">PLA Dashboard</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="prediction.html">ML Prediction</a></li>
                <li class="nav-item"><a class="nav-link" href="weather.html">Airport Weather</a></li>
                <li class="nav-item active"><a class="nav-link" href="japan.html">Japan MOD</a></li>
                <li class="nav-item"><a class="nav-link" href="news.html">News</a></li>
                <li class="nav-item"><a class="nav-link" href="download.html">Download</a></li>
            </ul>
        </div>
    </div>
</nav>

<!-- Page Header -->
<div class="page-header">
    <div class="container">
        <h1>Japan MOD Agent</h1>
        <p class="lead">Naval transit monitoring from Japan Joint Staff Office (統合幕僚監部)</p>
    </div>
</div>

<!-- Main Content -->
<div class="container">
    <!-- Update Info -->
    <div class="update-info">
        <strong>Data Source:</strong>
        <a href="https://www.mod.go.jp/js/press/index.html" target="_blank" class="source-link">Japan MOD Joint Staff Press</a> |
        <strong>Total Records:</strong> <span id="totalRecords">-</span> |
        <strong>Date Range:</strong> <span id="dateRange">-</span>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="stat-card">
                <div class="stat-label">Total Transit Events</div>
                <div class="stat-value" id="totalTransits">-</div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="stat-card">
                <div class="stat-label">Yonaguni (與那國)</div>
                <div class="stat-value" id="yonaguniCount">-</div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="stat-card">
                <div class="stat-label">Miyako (宮古)</div>
                <div class="stat-value" id="miyakoCount">-</div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="stat-card">
                <div class="stat-label">Joint Exercises</div>
                <div class="stat-value" id="jointExercise">-</div>
            </div>
        </div>
    </div>

    <!-- Latest Events Section -->
    <div class="card-custom">
        <h5>Latest Naval Transit Reports (最新艦艇動向)</h5>
        <div class="row" id="latestEventsContainer">
            <!-- Latest events will be populated by JavaScript -->
            <div class="col-12 text-center py-3">
                <span class="text-muted">Loading latest events...</span>
            </div>
        </div>
    </div>

    <!-- Map -->
    <div class="card-custom">
        <h5>Strait Locations & Latest Transit Events</h5>
        <p class="text-muted mb-2">Click on markers to see detailed transit information</p>
        <div id="map"></div>
    </div>

    <!-- Charts Row -->
    <div class="row">
        <div class="col-lg-6">
            <div class="chart-container">
                <h5>Transit Events by Strait</h5>
                <canvas id="straitChart"></canvas>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="chart-container">
                <h5>Monthly Transit Trend</h5>
                <canvas id="trendChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Data Table -->
    <div class="card-custom">
        <h5>Recent Transit Events (Latest 100)</h5>
        <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
            <table class="table table-striped table-hover table-sm">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>PLA Sorties</th>
                        <th>Yonaguni<br>與那國</th>
                        <th>Miyako<br>宮古</th>
                        <th>Osumi<br>大禹</th>
                        <th>Tsushima<br>對馬</th>
                        <th>Joint Ex<br>聯合演訓</th>
                        <th>Direction</th>
                        <th>Vessel Type</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
                <tbody id="transitTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <!-- Strait Information -->
    <div class="card-custom">
        <h5>Monitored Straits Information</h5>
        <div class="row">
            <div class="col-md-3">
                <h6><span class="strait-badge strait-yonaguni">與那國海峽</span></h6>
                <p>Yonaguni Strait - Between Yonaguni Island and Taiwan. Key chokepoint near Taiwan.</p>
            </div>
            <div class="col-md-3">
                <h6><span class="strait-badge strait-miyako">宮古海峽</span></h6>
                <p>Miyako Strait - Between Miyako and Okinawa. Major PLAN transit route to Pacific.</p>
            </div>
            <div class="col-md-3">
                <h6><span class="strait-badge strait-osumi">大隅海峽</span></h6>
                <p>Osumi Strait - Southern route between Kyushu and Osumi Islands.</p>
            </div>
            <div class="col-md-3">
                <h6><span class="strait-badge strait-tsushima">對馬海峽</span></h6>
                <p>Tsushima Strait - Korea Strait between Japan and Korean Peninsula.</p>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="text-center py-4 mt-5" style="background-color: #343a40; color: white;">
    <div class="container">
        <p>PLA Military Data Analysis Dashboard</p>
        <p>
            <a href="https://github.com/s0914712" target="_blank" style="color: #c94b4b;">GitHub</a> |
            <a href="https://s0914712.github.io" target="_blank" style="color: #c94b4b;">Blog</a>
        </p>
    </div>
</footer>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
let transitData = [];
let map = null;

// Strait coordinates
const straitCoords = {
    'yonaguni': { lat: 24.4500, lng: 122.9500, name: '與那國海峽 (Yonaguni)', color: '#e74c3c' },
    'miyako': { lat: 24.7800, lng: 125.3000, name: '宮古海峽 (Miyako)', color: '#3498db' },
    'osumi': { lat: 30.7500, lng: 130.6500, name: '大隅海峽 (Osumi)', color: '#2ecc71' },
    'tsushima': { lat: 34.2000, lng: 129.3000, name: '對馬海峽 (Tsushima)', color: '#9b59b6' }
};

let latestEventMarkers = [];

window.addEventListener('load', async function() {
    initMap();
    await loadTransitData();
    updateStatistics();
    renderLatestEvents();
    renderCharts();
    renderTable();
});

function initMap() {
    map = L.map('map').setView([28, 128], 5);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Add strait markers
    Object.entries(straitCoords).forEach(([key, strait]) => {
        const icon = L.divIcon({
            className: 'custom-marker',
            html: `<div style="
                background: ${strait.color};
                width: 15px;
                height: 15px;
                border-radius: 50%;
                border: 2px solid white;
                box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            "></div>`,
            iconSize: [15, 15],
            iconAnchor: [7, 7]
        });

        const marker = L.marker([strait.lat, strait.lng], { icon: icon }).addTo(map);
        marker.bindPopup(`<strong>${strait.name}</strong>`);
    });

    // Draw approximate strait lines
    const straitLines = [
        { coords: [[24.2, 122.5], [24.7, 123.3]], color: '#e74c3c', name: 'Yonaguni' },
        { coords: [[24.5, 124.8], [25.1, 125.8]], color: '#3498db', name: 'Miyako' },
        { coords: [[30.5, 130.2], [31.0, 131.0]], color: '#2ecc71', name: 'Osumi' },
        { coords: [[33.8, 128.8], [34.6, 129.8]], color: '#9b59b6', name: 'Tsushima' }
    ];

    straitLines.forEach(line => {
        L.polyline(line.coords, {
            color: line.color,
            weight: 4,
            opacity: 0.7,
            dashArray: '10, 10'
        }).addTo(map);
    });

    // Add legend
    const legend = L.control({ position: 'bottomright' });
    legend.onAdd = function() {
        const div = L.DomUtil.create('div', 'legend');
        div.innerHTML = `
            <div style="background: white; padding: 10px; border-radius: 5px;">
                <div><span style="display:inline-block;width:12px;height:12px;background:#e74c3c;border-radius:50%;margin-right:5px;"></span>Yonaguni</div>
                <div><span style="display:inline-block;width:12px;height:12px;background:#3498db;border-radius:50%;margin-right:5px;"></span>Miyako</div>
                <div><span style="display:inline-block;width:12px;height:12px;background:#2ecc71;border-radius:50%;margin-right:5px;"></span>Osumi</div>
                <div><span style="display:inline-block;width:12px;height:12px;background:#9b59b6;border-radius:50%;margin-right:5px;"></span>Tsushima</div>
            </div>
        `;
        return div;
    };
    legend.addTo(map);
}

async function loadTransitData() {
    try {
        const response = await fetch('data/JapanandBattleship.csv');
        const text = await response.text();
        const cleanText = text.replace(/^\uFEFF/, '');

        const parsed = Papa.parse(cleanText, {
            header: true,
            skipEmptyLines: true
        });

        transitData = parsed.data;
        console.log('Loaded transit data:', transitData.length, 'records');
    } catch (error) {
        console.error('Error loading transit data:', error);
    }
}

function hasValue(val) {
    return val && val !== '' && val !== 'FALSE' && val !== '0' && val !== 'false';
}

function getStraitForEvent(row) {
    // Determine which strait the event occurred at
    if (hasValue(row['與那國'])) return 'yonaguni';
    if (hasValue(row['宮古'])) return 'miyako';
    if (hasValue(row['大禹'])) return 'osumi';
    if (hasValue(row['對馬'])) return 'tsushima';
    return null;
}

function renderLatestEvents() {
    const container = document.getElementById('latestEventsContainer');

    // Find latest 3 events with remarks (sorted by date descending)
    const eventsWithRemarks = transitData
        .filter(row => row.remark && row.remark.trim() !== '' && row.remark !== '-')
        .sort((a, b) => {
            const dateA = new Date(a.date?.replace(/\//g, '-') || '1970-01-01');
            const dateB = new Date(b.date?.replace(/\//g, '-') || '1970-01-01');
            return dateB - dateA;
        })
        .slice(0, 3);

    if (eventsWithRemarks.length === 0) {
        container.innerHTML = `
            <div class="col-12 text-center py-3">
                <span class="text-muted">No recent transit events with detailed reports</span>
            </div>
        `;
        return;
    }

    // Render event cards
    container.innerHTML = '';
    eventsWithRemarks.forEach((event, index) => {
        const straitKey = getStraitForEvent(event);
        const straitInfo = straitKey ? straitCoords[straitKey] : null;

        // Build strait badges
        let straitBadges = '';
        if (hasValue(event['與那國'])) straitBadges += '<span class="event-strait strait-yonaguni">與那國</span>';
        if (hasValue(event['宮古'])) straitBadges += '<span class="event-strait strait-miyako">宮古</span>';
        if (hasValue(event['大禹'])) straitBadges += '<span class="event-strait strait-osumi">大禹</span>';
        if (hasValue(event['對馬'])) straitBadges += '<span class="event-strait strait-tsushima">對馬</span>';

        const direction = hasValue(event['進']) ? '← 進入東海' : (hasValue(event['出']) ? '→ 出向太平洋' : '');

        const cardHtml = `
            <div class="col-md-4 mb-3">
                <div class="latest-event-card">
                    <div class="event-date">
                        <strong>${event.date || 'Unknown Date'}</strong>
                        ${direction ? `<span class="ml-2 badge badge-secondary">${direction}</span>` : ''}
                    </div>
                    <div class="mt-2">
                        ${straitBadges || '<span class="text-muted">No specific strait</span>'}
                    </div>
                    ${event['艦型'] && event['艦型'] !== '未提及' ? `<div class="mt-2"><small><strong>艦型:</strong> ${event['艦型']}</small></div>` : ''}
                    <div class="event-remark mt-2">
                        ${event.remark || 'No details available'}
                    </div>
                </div>
            </div>
        `;
        container.innerHTML += cardHtml;

        // Add marker on map for this event
        if (straitInfo) {
            addEventMarker(event, straitInfo, index);
        }
    });
}

function addEventMarker(event, straitInfo, index) {
    // Offset slightly to prevent overlap
    const latOffset = (index - 1) * 0.3;
    const lngOffset = (index - 1) * 0.5;

    const icon = L.divIcon({
        className: 'custom-event-marker',
        html: `<div class="pulse-marker" style="
            background: linear-gradient(135deg, #c94b4b 0%, #4b134f 100%);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        ">${index + 1}</div>`,
        iconSize: [30, 30],
        iconAnchor: [15, 15]
    });

    const marker = L.marker(
        [straitInfo.lat + latOffset, straitInfo.lng + lngOffset],
        { icon: icon, zIndexOffset: 1000 }
    ).addTo(map);

    // Build strait badges for popup
    let straitBadges = '';
    if (hasValue(event['與那國'])) straitBadges += '<span class="badge" style="background:#e74c3c;color:white;">與那國</span> ';
    if (hasValue(event['宮古'])) straitBadges += '<span class="badge" style="background:#3498db;color:white;">宮古</span> ';
    if (hasValue(event['大禹'])) straitBadges += '<span class="badge" style="background:#2ecc71;color:white;">大禹</span> ';
    if (hasValue(event['對馬'])) straitBadges += '<span class="badge" style="background:#9b59b6;color:white;">對馬</span> ';

    const direction = hasValue(event['進']) ? '← 進入東海 (In)' : (hasValue(event['出']) ? '→ 出向太平洋 (Out)' : '');

    const popupContent = `
        <div class="event-popup">
            <h6>Latest Event #${index + 1}</h6>
            <div style="margin-bottom:8px;">
                <strong>Date:</strong> ${event.date || '-'}<br>
                ${direction ? `<strong>Direction:</strong> ${direction}<br>` : ''}
                <strong>Straits:</strong> ${straitBadges || '-'}
            </div>
            ${event['艦型'] && event['艦型'] !== '未提及' ? `<div style="margin-bottom:8px;"><strong>艦型 (Vessel Type):</strong><br><small>${event['艦型']}</small></div>` : ''}
            <div style="background:#f8f9fa;padding:8px;border-radius:5px;font-size:0.85rem;line-height:1.5;">
                <strong>Report:</strong><br>
                ${event.remark || 'No details available'}
            </div>
        </div>
    `;

    marker.bindPopup(popupContent, { maxWidth: 350 });
    latestEventMarkers.push(marker);
}

function updateStatistics() {
    document.getElementById('totalRecords').textContent = transitData.length.toLocaleString();

    // Date range
    const dates = transitData.filter(r => r.date).map(r => r.date).sort();
    if (dates.length > 0) {
        document.getElementById('dateRange').textContent = `${dates[0]} - ${dates[dates.length - 1]}`;
    }

    // Count transits
    let yonaguni = 0, miyako = 0, osumi = 0, tsushima = 0, jointEx = 0;

    transitData.forEach(row => {
        if (hasValue(row['與那國'])) yonaguni++;
        if (hasValue(row['宮古'])) miyako++;
        if (hasValue(row['大禹'])) osumi++;
        if (hasValue(row['對馬'])) tsushima++;
        if (hasValue(row['聯合演訓'])) jointEx++;
    });

    document.getElementById('totalTransits').textContent = (yonaguni + miyako + osumi + tsushima).toLocaleString();
    document.getElementById('yonaguniCount').textContent = yonaguni;
    document.getElementById('miyakoCount').textContent = miyako;
    document.getElementById('jointExercise').textContent = jointEx;
}

function renderCharts() {
    // Strait distribution chart
    let yonaguni = 0, miyako = 0, osumi = 0, tsushima = 0;

    transitData.forEach(row => {
        if (hasValue(row['與那國'])) yonaguni++;
        if (hasValue(row['宮古'])) miyako++;
        if (hasValue(row['大禹'])) osumi++;
        if (hasValue(row['對馬'])) tsushima++;
    });

    new Chart(document.getElementById('straitChart'), {
        type: 'doughnut',
        data: {
            labels: ['Yonaguni (與那國)', 'Miyako (宮古)', 'Osumi (大禹)', 'Tsushima (對馬)'],
            datasets: [{
                data: [yonaguni, miyako, osumi, tsushima],
                backgroundColor: ['#e74c3c', '#3498db', '#2ecc71', '#9b59b6']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // Monthly trend chart
    const monthlyData = {};
    transitData.forEach(row => {
        if (!row.date) return;
        const date = new Date(row.date);
        if (isNaN(date)) return;
        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;

        if (!monthlyData[monthKey]) {
            monthlyData[monthKey] = { total: 0, sorties: 0 };
        }

        if (hasValue(row['與那國']) || hasValue(row['宮古']) || hasValue(row['大禹']) || hasValue(row['對馬'])) {
            monthlyData[monthKey].total++;
        }
        if (row.pla_aircraft_sorties) {
            monthlyData[monthKey].sorties += parseFloat(row.pla_aircraft_sorties) || 0;
        }
    });

    // Get last 24 months
    const months = Object.keys(monthlyData).sort().slice(-24);
    const transitCounts = months.map(m => monthlyData[m].total);

    new Chart(document.getElementById('trendChart'), {
        type: 'line',
        data: {
            labels: months,
            datasets: [{
                label: 'Transit Events',
                data: transitCounts,
                borderColor: '#c94b4b',
                backgroundColor: 'rgba(201, 75, 75, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

function renderTable() {
    const tbody = document.getElementById('transitTableBody');
    tbody.innerHTML = '';

    // Get latest 100 records
    const recentData = transitData.slice(-100).reverse();

    recentData.forEach(row => {
        const direction = hasValue(row['進']) ? '進 (In)' : (hasValue(row['出']) ? '出 (Out)' : '-');
        const dirClass = hasValue(row['進']) ? 'transit-in' : (hasValue(row['出']) ? 'transit-out' : '');

        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${row.date || '-'}</td>
            <td><strong>${row.pla_aircraft_sorties || '-'}</strong></td>
            <td>${hasValue(row['與那國']) ? '✅' : '-'}</td>
            <td>${hasValue(row['宮古']) ? '✅' : '-'}</td>
            <td>${hasValue(row['大禹']) ? '✅' : '-'}</td>
            <td>${hasValue(row['對馬']) ? '✅' : '-'}</td>
            <td>${hasValue(row['聯合演訓']) ? '✅' : '-'}</td>
            <td class="${dirClass}">${direction}</td>
            <td><small>${row['艦型'] || '-'}</small></td>
            <td><small>${row['備考'] || row['remark'] || '-'}</small></td>
        `;
        tbody.appendChild(tr);
    });
}
</script>

</body>
</html>
